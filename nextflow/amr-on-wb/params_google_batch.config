/* * Google Batch Configuration File
 * This file sets all parameters for running on Google Cloud Batch.
 * It uses the 'GCS_BUCKET' environment variable to define paths.
 */ 

// Grabs the GCS_BUCKET environment variable. Defaults to 'nf-files' if not set.
def gcs_bucket = System.getenv("GCS_BUCKET") ?: "nf-files"

params {
    /* Display help message */
    help = false

    // -----------------------------------------------------------------
    //  Input Data
    // -----------------------------------------------------------------
    /* Location of forward and reverse read pairs */
    reads = "gs://${gcs_bucket}/data/raw/*_R{1,2}.fastq.gz"

    /* Optional input for bam files for use with "--pipeline bam_resistome" */
    bam_files = null

    // -----------------------------------------------------------------
    //  Reference Databases
    // -----------------------------------------------------------------
    /* Location of reference/host genome */
    host = "gs://${gcs_bucket}/data/host/chr21.fasta.gz"

    /* Host index files created with bwa */
    host_index = "gs://${gcs_bucket}/data/host/chr21.fasta.gz*"

    /* Location of amr index files with wildcard - set to null to build automatically */
    amr_index = null

    /* Location of antimicrobial resistance (MEGARes) database */
    amr = "gs://${gcs_bucket}/data/amr/megares_database_v3.00.fasta"

    /* Location of amr annotation file */
    annotation = "gs://${gcs_bucket}/data/amr/megares_annotations_v3.00.csv"

    /* Kraken database location */   
    kraken_db = null
    
    /* Kraken confidence score */
    kraken_confidence = 0.0

    // -----------------------------------------------------------------
    //  Output
    // -----------------------------------------------------------------
    /* Output directory - Saved to Cloud Storage */
    output = "gs://${gcs_bucket}/results/test_results"

    // -----------------------------------------------------------------
    //  Pipeline Logic & Analysis Toggles
    // -----------------------------------------------------------------
    /* Add SNP analysis */
    snp = "Y"

    /* Add deduplicaation analysis */
    deduped = "N"
    prefix = "AMR"

    /* Number of threads */
    threads = 4

    // -----------------------------------------------------------------
    //  Trimming Parameters (Trimmomatic)
    // -----------------------------------------------------------------
    /* Adapters file location */
    adapters = "gs://${gcs_bucket}/data/adapters/nextera.fa"

    leading = 3
    trailing = 3
    slidingwindow = "4:15"
    minlen = 36

    // -----------------------------------------------------------------
    //  Resistome Analysis Parameters
    // -----------------------------------------------------------------
    /* Resistome threshold */
    threshold = 80

    /* Starting rarefaction level */
    min = 5

    /* Ending rarefaction level */
    max = 100

    /* Number of levels to skip */
    skip = 5

    /* Number of iterations to sample at */
    samples = 1

    // -----------------------------------------------------------------
    //  Other Tools
    // -----------------------------------------------------------------
    /* multiQC config folder */
    multiqc = "gs://${gcs_bucket}/data/multiqc"

    /* Qiime2 Parameters */
    p_trim_left_f = 25
    p_trim_left_r = 26
    p_trunc_len_f = 225
    p_trunc_len_r = 220

    /* qiime2 bayes classifier */
    dada2_db = "gs://${gcs_bucket}/data/qiime/gg-13-8-99-515-806-nb-classifier.qza"
}

// -----------------------------------------------------------------
//  Environment Variables / Binary Paths
// -----------------------------------------------------------------
env {
    /* These following tools are required to run AmrPlusPlus*/
    JAVA = "java"
    TRIMMOMATIC = "trimmomatic"
    PYTHON3 = "python3"
    BWA = "bwa"
    SAMTOOLS = "samtools"
    BEDTOOLS = 	"bedtools"
    RESISTOME = 	"resistome"
    RAREFACTION = 	"rarefaction"
    SNPFINDER = 	"snpfinder"
    /* These next tools are optional depending on which analyses you want to run */
    KRAKEN2 = "kraken2"
    QIIME = "qiime"
}
